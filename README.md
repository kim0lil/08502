# 마이바티스

이번에 살펴 볼 것은 마이바티스의 기초 설정과 사용법 그리고 중급 사용법까지 설명 할 것입니다.

우리가 배울 마이바티스는 자바 퍼시스턴스 프레임워크의 하나로써 JDBC로 처리하는 상당부분의 코드와 파라미터 설정 및 결과 매핑을 대신해 줍니다.

아래와 같은 그림이 마이바티스의 전체적인 모양입니다.

<< 그림 1-1. mybatis architecture >>

![그림보기](./images/001/001.png)

먼저 전체적인 매퍼 프레임워크가 뭔지부터 살펴 보면서

차근 차근 마이바티스 구문을 살펴 보도록 하겠습니다.

## JDBC

JDBC(Java Database Connectivity)는 자바 데이터베이스를 연결하도록 지원하는 인터페이스로써 JDBC에서 전형적으로 사용되는(침투적인 코드) 코드가 많습니다.

아래 코드를 보면서 말해 보도록 하겠습니다.

[소스보기](./sources/001/step001.java)

이 코드는 데이터베이스와 접속 하기 위하는 jdbc의 고유 코드로써

이 행위를 통하여 데이터베이스에 접속하여 쿼리를 날려 처리 할 수 있는 것입니다.

따라서 이 모양은 쿼리를 보내는 순간 똑같이 유지 될 것입니다.

아래와 같이 말입니다.

[소스보기](./sources/001/step002.java)

select, update, insert, delete 등 모든 구문에서 데이터베이스에 접속 하는 구문이 있는 것을 확인 할 수 있습니다.

이 구문들은 공통화 되지 못한 관계로 작은 변경에도 큰 파동을 일으킬 수 있습니다.

(예로써 url의 host ip가 변경 될 경우 `DriverManager.getConnection`시 사용 되는 모든 구문이 변하여야 합니다.)

[소스보기](./sources/001/step003.java)

따라서 우리는 이 접속 정보를 추상화 할 필요가 생겼습니다.

### jdbc 접속 정보의 추상화

그러면 접속 정보를 추상화 해보도록 하겠습니다.

접속 정보는 아래와 같이 공통적으로 특정 한 행동을 하는 정보를 추출하여 분리 하는 것 부터 시작합니다.

우리는 클래스 드라이버를 로딩하고 Connection을 맷는 과정을 메소드 추출 방법을 통하여 `getConnection`으로 추상화 해 보도록 하겠습니다.

[소스보기](./sources/001/step004.java)

그 외에도 여러 방법을 사용하여 분리 할 수 있지만 이 장에서 설명할 범위에 벗어 나므로 넘어 가도록 하겠습니다.

### 설정 분리

이번에는 설정 정보를 사용하여 접속 시 처리 해 보도록 하겠습니다.

아래와 같이 설정 파일을 하나 만들어 봅니다.

[소스보기](./sources/001/step005.properties)

다음으로 실행 시 설정 파일을 불러 오도록 하겠습니다.

[소스보기](./sources/001/step006.java)

### SQL 분리

이번에는 SQL문을 분리 해 보도록 하겠습니다.

조회 하는 소스를 다시 한번 살펴 보겠습니다.

[소스보기](./sources/001/step007.java)

`prepareStatement`를 불러 오고 `SQL`에 파라미터를 매핑하여 실행 하는 것을 볼 수 있습니다.

먼저 SQL문을 외부로 분리 하여 보도록 하겠습니다.

파일을 하나 생성한 다음 SQL문을 등록 합니다.

[소스보기](./sources/001/step008.properties)

그런 다음 등록 한 SQL문을 로드 시 불러 오도록 합니다.

[소스보기](./sources/001/step009.java)

### Mapper 등장

이제 `executeQuery`를 실행하여 실행 결과 값을 반환 받을 수 있습니다.

이 `executeQuery` 문은 `ResultSet`을 반환하도록 작성 되어 있습니다.

따라서 쿼리문을 담아 보도록 하겠습니다.

그 전에 먼저 값을 담을 도메인을 하나 생성하여 보도록 하겠습니다.

[소스보기](./sources/001/step010.java)

이제 `ResultSet`을 실행 하는 코드를 추가해 보도록 하겠습니다.

[소스보기](./sources/001/step011.java)

매퍼 클래스를 만들어 보도록 하겠습니다.

[소스보기](./sources/001/step012.java)

(매퍼 클래스는 데이터베이스와 연결을 담당하고 `prepareStatement`에서 `SQL`을 불러 오고 `ResultSet`과 `shop`을 매핑해 주는 역활을 합니다.)

다음으로 `selectOne` 메서드를 생성해 보겠습니다.

기존 jdbc 소스를 사용하면 이렇게 사용 될 것입니다.

[소스보기](./sources/001/step013.java)

이번에는 좀 더 추상화 시켜 보도록 하겠습니다.

추상화 대상은 `Connection`에서 `PrepareStatement`를 추출하고 setObject로 값을 넣는 행동입니다.

[소스보기](./sources/001/step014.java)

다음 추상화 대상은 ResultSet 과 shop 객체를 묶는 행동을 추상화 해 보도록 하겠습니다.

그러기 위해서 먼저 인터페이스를 하나 생성하여 Mapping할 수 있도록 느슨하게 만들어 보겠습니다.

[소스보기](./sources/001/step015.java)

느슨하게 만들어진 인터페이스를 기반으로 추상화 대상을 처리 하는 함수를 하나 만들어 보겠습니다.

[소스보기](./sources/001/step016.java)

이제 가변 인자가 되는 항목들을 외부로 맞겨 모듈화를 해 보겠습니다.

[소스보기](./sources/001/step017.java)

실행 아래와 같이 실행 할 수 있습니다

[소스보기](./sources/001/step018.java)

고생하셨습니다.

이렇게 우리가 만든 클래스를 퍼시스턴스 계층을 담당하는 매퍼 프레임워크 라고 합니다.

마이바티스에서는 좀 더 활용적이고 범용 적으로 사용 할 수 있는 프레임워크를 제공하니 다음 장 부터는 마이바티스의 설정방법 부터

사용법까지 설명해 보도록 하겠습니다.

## 마이바티스 설정 파일

